## 一、介绍

RAG透过集成外部知识源增强大模型，存在局限性

- 对平面数据表示的依赖
- 上下文感知不足
- 答案碎片化
- 无法捕获复杂依赖关系

RAG可以确保提供的资讯相关且为使用者的需求量身定制

**分块**促进了RAG的过程，提高检索的准确性

为了解决RAG的不足，建议将图形结构合并到文本索引和信息检索。

图在表示实体之间的相互依赖关系特别有效

#### 有三个挑战

- 1.**综合咨询检索**-需要确保全面的信息检索，从所有文档中捕获相互依赖的实体的完整上下文
- 2.**检索效率**-基于图的知识结构的检索效率需要提高，来缩短响应时间
- 3.**快速适应新数据**-能够快速适应新数据更新，确保系统在动态环境依然可以保持相关性

#### LightRAG：一种将基于图形的文本索引范式与双级检索框架无缝集成的模型

- 低级检索（局部检索）：侧重于有关特定实体和关系的精确咨询
- 高级检索（全局检索）：涵盖更广泛的主体和主题。

### 主要贡献

#### 1.一般方面：

透过将图形结构集成到文本索引，可以有效的表示实体间的复杂依赖关系，实现连贯的上下文丰富的回应

#### 2.方法：

将双级检索范式和图形增强文本索引集成在一起，可以捕获低级（局部）高级（全局）资讯，进行更全面高效的检索。消除重建索引的需求，确保增量更新算法可以及时集成新数据，在动态环境保持有效性

#### 3.实验结果：

进行广泛的实验与其他rag模型进行对比，包含准确性、模型消融、回应效率、对新资讯的适应性。



## 二、相关知识（工作）

### RAG

RAG包含两个基本元素：

- 检索元件-根据输入查询来识别并从外部知识库获取相关文件或咨询检索最相关的数据
- 生成元件-获取检索到的咨询并生成连贯的、上下文相关的回应，利用llm来生成有意义的输出。

#### 需要完成的关键点：

- 全面的信息检索：索引功能必须善于提取全局咨询，这对模型有效回答查询的能力影响很大
- 高效且低成本的检索：索引数据结构必须能实现快速且搞笑的检索
- 快速适应数据变化：快速有效的调整数据结构来整合新资讯的能力



## 三、LightRAG架构

![Refer to caption](https://arxiv.org/html/2410.05779v2/x1.png)

 **图形增强的实体关系提取**

LightRAG透过将文件分割成更小、更易于管理的片段来增强检索系统。利用LLM识别和提取各种实体以及他们之间的关系，用于创建全面的知识图谱。

- **R(·)提取实体和关系**---负责识别文本数据中的实体和关系。为了提高效率将D分割成多个Di。
- **P(·)生成键值对的分析**---为每个实体和关系生成一个文本键值对。每个键是一个单词或短语，可以实现高效检索，对应的值是一个文本段落，总结来自外部资料来帮助文字产生。实体使用自己的名称作为唯一的索引键，关系可能具有多个来自LLM增强的索引键，其中包括来自连接实体的全域主题。
- **D(·)数据删除函数**---用于识别并合并来自原始文本不同片段的相同实体和关系，达到最小化图形来有效减少与图形操作相关的开销。

LightRAG透过图形增强的实体关系提取获得了两个优势

- **全面的咨询理解**：构建图形结构能够大大增强LightRAG处理跨越多个文档的复杂查询能力
- **增强的检索性能**： 从图形派生的键值数据结构经过优化，可以快速、精确的检索，优于目前常用的嵌入匹配方法和块遍历技术。

**双级检索范式**

为了从特定文档和复杂的依赖关系检索相关信息，LightRAG在详细和抽象级别生成查询键

- **特定查询：**面相细节，通常引用图中的特定实体，需要精确检索特定节点与关系相关的资讯。ex：谁写了傲慢与偏见？
- **抽象查询：**更具概念性，包含更广泛的主题、摘要或与特定实体没直接关联的主题。ex：人工智能如何影响现代教育？

为了适应以上两种查询类别，LightRAG在双级检索范式采用两种不同的检索策略

- **低级检索（局部检索）：**侧重于检索特定的实体及其关联的属性或关系。以细节为导向，旨在提取有关图中特定节点或边的精确资讯。
- **高级检索（全局检索）：**涉及更广泛的主题和总体主题，聚合多个相关实体和关系中的资讯，从而提供更高级别概念的摘要的见解。 

集成图形和向量实现高效检索

1. **查询关键字提取**：对于给定的查询，首先提取局部查询关键字和全局查询关键字
2. **关键字匹配**：使用搞笑的向量资料库将局部查询关键字与候选实体匹配，并将全局查询关键字与连接到全局键的关系进行匹配
3. **纳入高阶相关性**：为了增强具有更高阶相关性的查询，在检索到的图元素的局部子图中手机相邻节点。

**检索-增强答案生成**

- **检索到的资讯的利用率：**利用检索到的信息，采用LLM根据收集的数据生成答案。这里的数据包含来自实体和关系的串联值，由P(·)生成，包含名称、实体和关系的描述以及原始文本的摘录
- **上下文集成和答案生成：**通过将查询与多源文本同意，LLM生成为使用者的需求定制的答案，确保与查询的意图保持一致。

**LightRAG框架的复杂性分析**

LightRAG整体框架可以分为两部分。

- 第一部分是基于图形的索引阶段，在这个阶段使用LLM从文本块中提取实体和关系。需要调用LLM总tokens除chunk size次。此过程不涉及额外的开销，使得LightRAG在管理新文本的更新方面非常高效
- 第二部分涉及基于图形的检索阶段，对于每个查询先利用LLM生成相关关键词（类似现在的RAG系统依赖基于向量的检索），但是与传统RAG检索块不同，LightRAG专注于检索实体和关系，与GraphRAG基于社区的遍历方法相比，减少了检索开销。